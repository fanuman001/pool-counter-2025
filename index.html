<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ELITE æ’çƒè¯è³½çµ‚æ¥µç³»çµ± v55.0</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --win: #27ae60;
            --lose: #c0392b;
            --bg: #f4f7f6;
            --card: #ffffff;
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 10px;
            font-size: 18px; /* åŠ å¤§åŸºç¤å­—é«” */
            user-select: none;
        }

        /* æˆ°å ´ UI èª¿æ•´ */
        .battlefield {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .team-card {
            background: var(--card);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .team-card.winner { border-color: var(--win); background: #f0fff4; }

        .team-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }

        /* åœ“å½¢æˆå“¡æŒ‰éˆ• */
        .member-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .member-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid #ddd;
            position: relative;
            transition: transform 0.1s;
        }
        .member-btn:active { transform: scale(0.9); }
        .member-btn.in-team { background: var(--primary); color: white; border-color: #34495e; }

        /* é ç®—é¡¯ç¤º */
        .budget-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .budget-pos { color: var(--win); border: 1px solid var(--win); }
        .budget-neg { color: var(--lose); border: 1px solid var(--lose); }

        /* åª½çƒ UI (åœ“å‹è™›ç·š) */
        .ma-container {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .ma-slot {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px dashed #bbb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #999;
            cursor: pointer;
        }
        .ma-slot.active {
            border-style: solid;
            background: #f1c40f;
            color: #000;
            border-color: #f39c12;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
        }

        /* æ§åˆ¶æŒ‰éˆ• */
        .btn {
            padding: 15px 25px;
            border-radius: 12px;
            border: none;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn:active { opacity: 0.7; }
        .btn-main { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
        .btn-random { background: #9b59b6; color: white; }
        .btn-danger { background: var(--lose); color: white; }

        /* è·‘é¦¬ç‡ˆå‹•ç•« */
        @keyframes shuffle {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); background: #9b59b6; }
            100% { transform: translateY(0); }
        }
        .shuffling { animation: shuffle 0.2s infinite; }

        /* è¨­å®šé¢æ¿ */
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            background: #eee;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .settings-grid label { font-size: 14px; color: #666; }
        .settings-grid input { width: 80%; padding: 8px; border-radius: 8px; border: 1px solid #ccc; }

        /* åˆ†æé¢æ¿ */
        .analysis-box {
            background: #fff;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            border-left: 5px solid #3498db;
        }
    </style>
</head>
<body>

<div id="app">
    <div class="settings-grid">
        <div>
            <label>åº•é‡‘å–®åƒ¹</label><br>
            <input type="number" v-model.number="config.basePrice">
        </div>
        <div>
            <label>çƒåƒ¹å–®åƒ¹</label><br>
            <input type="number" v-model.number="config.ballPrice">
        </div>
        <div>
            <label>å½©è›‹å–®åƒ¹</label><br>
            <input type="number" v-model.number="config.maPrice">
        </div>
        <div>
            <label>åª½çƒå€ç‡ (2,3,4...)</label><br>
            <input type="text" v-model="config.maRates" placeholder="3,4,6">
        </div>
    </div>

    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <button class="btn btn-random" @click="randomTeams" :disabled="isShuffling">
            {{ isShuffling ? 'è·‘é¦¬ç‡ˆä¸­...' : 'éš¨æ©Ÿåˆ†éšŠ' }}
        </button>
        <button class="btn" style="background:#34495e; color:white" @click="addNewTeam">æ–°å¢éšŠä¼</button>
        <button class="btn btn-danger" @click="allOffline">ä¸€éµä¸‹ç·š</button>
    </div>

    <div class="battlefield">
        <div v-for="(team, tIdx) in teams" :key="tIdx" 
             class="team-card animate__animated animate__fadeIn"
             :class="{ winner: winnerTeam === tIdx }">
            
            <div class="team-title">
                <span @click="setWinner(tIdx)">éšŠä¼ {{ tIdx + 1 }} {{ winnerTeam === tIdx ? 'ğŸ†' : '' }}</span>
                <span style="color:red; font-size:14px" @click="removeTeam(tIdx)">åˆªé™¤</span>
            </div>

            <div class="member-list">
                <div v-for="m in team.members" :key="m.id" class="member-btn in-team"
                     @click="cycleMember(m)">
                    {{ m.name }}
                    <div v-if="realtimeBudget[m.id]" class="budget-badge" 
                         :class="realtimeBudget[m.id] > 0 ? 'budget-pos' : 'budget-neg'">
                        {{ realtimeBudget[m.id] > 0 ? '+' : '' }}{{ realtimeBudget[m.id] }}
                    </div>
                </div>
                </div>

            <div style="margin-top:15px; font-size:14px">
                é€²çƒæ‰£æ¬¾å°è±¡:
                <select v-model="team.targetTeam" style="padding:5px">
                    <option :value="null">ç„¡</option>
                    <option v-for="(ot, oIdx) in teams" v-if="oIdx !== tIdx" :value="oIdx">éšŠä¼ {{ oIdx + 1 }}</option>
                </select>
                é€² <input type="number" v-model.number="team.balls" style="width:40px"> é¡†
            </div>

            <div class="ma-container">
                <div v-for="n in 4" :key="n" 
                     class="ma-slot" 
                     :class="{ active: team.mas >= n }"
                     @click="toggleMa(tIdx, n)">
                    {{ n }}åª½
                </div>
            </div>
        </div>
    </div>

    <div class="team-card">
        <div class="team-title">ç©å®¶éŒ¢åŒ… (å¯†ç¢¼ä¿®æ­£: 8888)</div>
        <div class="member-list">
            <div v-for="p in players" :key="p.id" 
                 class="member-btn" 
                 :class="{ 'in-team': p.status === 'online', 'shuffling': isShuffling }"
                 @click="toggleOnline(p)">
                <div style="text-align:center">
                    {{ p.name }}<br><small>${{ p.balance }}</small>
                </div>
            </div>
        </div>
        <button class="btn btn-main" @click="submitOrder" :disabled="winnerTeam === null">ç¢ºèªé€å–®</button>
        <button class="btn btn-main" style="background:#27ae60" @click="finalSettlement">ä¸€éµçµå–®æ­¸é›¶</button>
    </div>

    <div class="analysis-box">
        <h3>ğŸ“Š è¯è³½æ•¸æ“šåˆ†æ</h3>
        <p>ä»Šæ—¥å¤§ææ¬¾æ©Ÿï¼š{{ analysis.loser }}</p>
        <p>ä»Šæ—¥å¤§é­”ç‹ï¼š{{ analysis.winner }}</p>
        <p>æˆ°æ³é æ¸¬ï¼š{{ analysis.prediction }}</p>
        <div v-for="p in players" v-if="p.totalGames > 0" style="font-size:14px">
            {{ p.name }} - å‹ç‡: {{ ((p.wins / p.totalGames)*100).toFixed(1) }}% ({{ p.wins }}/{{ p.totalGames }})
        </div>
    </div>
</div>

<script>
new Vue({
    el: '#app',
    data: {
        isShuffling: false,
        winnerTeam: null,
        config: {
            basePrice: 75,
            ballPrice: 25,
            maPrice: 50,
            maRates: "3,4,6,8"
        },
        players: [
            { id: 1, name: 'å°æ˜', balance: 0, status: 'online', wins: 0, totalGames: 0 },
            { id: 2, name: 'é˜¿è¯', balance: 0, status: 'online', wins: 0, totalGames: 0 },
            { id: 3, name: 'å¤§å¼·', balance: 0, status: 'online', wins: 0, totalGames: 0 },
            { id: 4, name: 'è€å¼µ', balance: 0, status: 'online', wins: 0, totalGames: 0 },
            { id: 5, name: 'æ—è‘£', balance: 0, status: 'online', wins: 0, totalGames: 0 },
            { id: 6, name: 'é™³ç¸½', balance: 0, status: 'online', wins: 0, totalGames: 0 }
        ],
        teams: [
            { members: [], mas: 0, balls: 0, targetTeam: null },
            { members: [], mas: 0, balls: 0, targetTeam: null }
        ],
        history: []
    },
    computed: {
        // å¯¦æ™‚è¨ˆç®—é ç®— (æ ¸å¿ƒäººé ­ç¨…é‚è¼¯)
        realtimeBudget() {
            let budgets = {};
            this.players.forEach(p => budgets[p.id] = 0);
            if (this.winnerTeam === null) return budgets;

            const winTeam = this.teams[this.winnerTeam];
            const loseTeams = this.teams.filter((t, idx) => idx !== this.winnerTeam);
            
            // 1. åº•é‡‘è¨ˆç®— (è¼¸å®¶æ¯äººä»˜ 75)
            let totalLoseMembers = 0;
            loseTeams.forEach(t => totalLoseMembers += t.members.length);
            let totalBasePool = totalLoseMembers * this.config.basePrice;
            
            // åˆ†é…åº•é‡‘
            this.teams.forEach((team, idx) => {
                team.members.forEach(m => {
                    if (idx === this.winnerTeam) {
                        budgets[m.id] += totalBasePool / team.members.length;
                    } else {
                        budgets[m.id] -= this.config.basePrice;
                    }
                });
            });

            // 2. åª½çƒè¨ˆç®— (å…¨å±€åˆ†æ± )
            this.teams.forEach((team, tIdx) => {
                if (team.mas > 0) {
                    let rate = this.config.maRates.split(',')[team.mas-1] || 1;
                    let singleMaPay = this.config.maPrice * rate;
                    let othersCount = 0;
                    this.teams.forEach((ot, oIdx) => { if(oIdx !== tIdx) othersCount += ot.members.length; });
                    
                    let totalMaPool = singleMaPay * othersCount;
                    
                    this.teams.forEach((ot, oIdx) => {
                        ot.members.forEach(m => {
                            if(oIdx === tIdx) budgets[m.id] += totalMaPool / ot.members.length;
                            else budgets[m.id] -= singleMaPay;
                        });
                    });
                }
            });

            // 3. å®šå‘çƒåƒ¹è¨ˆç®—
            this.teams.forEach((team, tIdx) => {
                if (team.targetTeam !== null && team.balls > 0) {
                    let target = this.teams[team.targetTeam];
                    let totalBallCost = team.balls * this.config.ballPrice * target.members.length;
                    
                    target.members.forEach(m => budgets[m.id] -= (team.balls * this.config.ballPrice));
                    team.members.forEach(m => budgets[m.id] += totalBallCost / team.members.length);
                }
            });

            return budgets;
        },
        analysis() {
            if (this.players.every(p => p.balance === 0)) return { loser: 'å°šæœªé–‹è³½', winner: 'å°šæœªé–‹è³½', prediction: 'è§€å¯Ÿä¸­' };
            let sorted = [...this.players].sort((a, b) => a.balance - b.balance);
            return {
                loser: sorted[0].name,
                winner: sorted[sorted.length-1].name,
                prediction: `${sorted[sorted.length-1].name} æ°£å‹¢æ­£æ—ºï¼Œå»ºè­°å¤§å®¶é–ƒé¿ã€‚`
            };
        }
    },
    methods: {
        cycleMember(member) {
            // åœ¨éšŠä¼é–“å¾ªç’°
        },
        toggleOnline(p) {
            if (p.status === 'online') {
                p.status = 'offline';
                this.teams.forEach(t => t.members = t.members.filter(m => m.id !== p.id));
            } else {
                p.status = 'online';
                this.teams[0].members.push(p);
            }
        },
        setWinner(idx) {
            this.winnerTeam = (this.winnerTeam === idx) ? null : idx;
        },
        toggleMa(tIdx, n) {
            this.teams[tIdx].mas = (this.teams[tIdx].mas === n) ? 0 : n;
        },
        randomTeams() {
            this.isShuffling = true;
            setTimeout(() => {
                let online = this.players.filter(p => p.status === 'online');
                online.sort(() => Math.random() - 0.5);
                this.teams.forEach(t => t.members = []);
                online.forEach((p, i) => {
                    this.teams[i % this.teams.length].members.push(p);
                });
                this.isShuffling = false;
            }, 1500);
        },
        submitOrder() {
            let budgets = this.realtimeBudget;
            this.players.forEach(p => {
                p.balance += budgets[p.id];
                if (budgets[p.id] !== 0) p.totalGames++;
                if (this.teams[this.winnerTeam].members.find(m => m.id === p.id)) p.wins++;
            });
            // é‡ç½®æˆ°å ´
            this.winnerTeam = null;
            this.teams.forEach(t => { t.mas = 0; t.balls = 0; t.targetTeam = null; });
            alert("é€å–®æˆåŠŸï¼é‡‘é¡å·²æ›´æ–°è‡³éŒ¢åŒ…ã€‚");
        },
        allOffline() {
            this.players.forEach(p => p.status = 'offline');
            this.teams.forEach(t => t.members = []);
        },
        addNewTeam() {
            this.teams.push({ members: [], mas: 0, balls: 0, targetTeam: null });
        },
        removeTeam(idx) {
            this.teams.splice(idx, 1);
        },
        finalSettlement() {
            if (confirm("ç¢ºå®šè¦çµå–®æ­¸é›¶å—ï¼Ÿé€™å°‡æ¸…ç©ºæ‰€æœ‰åœ¨ç·šé¤˜é¡ä¸¦å­˜å…¥æ­·å²ç´€éŒ„ã€‚")) {
                this.players.forEach(p => p.balance = 0);
                alert("çµå–®å®Œæˆï¼ŒéŒ¢åŒ…å·²æ­¸é›¶ã€‚");
            }
        }
    }
});
</script>
</body>
</html>

